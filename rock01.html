<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HGPPL3SXDS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

gtag('config', 'G-HGPPL3SXDS', {
  'page_path': window.location.pathname
});




</script>
<title> Sunny Rockradio</title>
   <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
 <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Load FontAwesome icons -->
  <link rel="stylesheet"
        href=
"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
 
  <!-- Load the custom CSS style file -->
  <link rel="stylesheet" type="text/css" href="style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
     <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<style type="text/css">












<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
}

.top-container {
  background-color: #f1f1f1;
  padding: 30px;
  text-align: center;
}

.header {
  padding: 10px 16px;
  color: #f1f1f1;
}

.content {
  padding: 16px;
}

.sticky {
  position: fixed;
  top: 0; z-index: 1;
  width: 100%;
}

.sticky + .content {
  padding-top: 102px;
}
</style>
<!-- Load an icon library to show a hamburger menu (bars) on small screens -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Top Navigation Menu -->
<div class="topnav" id="myHeader">
  <h1 class="header"> <a href="#home" class="active"><img id= "logo"><img id= "licht">
  <!-- Navigation links (hidden by default) -->
  <div id="myLinks">
    
 

 <a href="https://sunnyrockradio.com/index.html">HOME<img id= "dwarf"></a>
 <a href="https://sunnyjazzradio.com/index.html">SUNNY<em>JAZZ</em> RADIO <img id= "lin"></a>
<a href="https://sunnyhotradio.com/index.html">SUNNY <em>DANCE</em> RADIO<img id= "linger"></a>


</div>
    <!-- "Hamburger menu" / "Bar icon" to toggle the navigation links -->
  <a href="javascript:void(0);" class="icon" onclick="myFunction1()">
    <div class="btn">
        <span class="fas fa-bars"></span>
    </div>
  </a>
</div>


















</head>


<body>

<div class = "arrow">










<br>
<br>
<br>
<br>
  <br>
<br>
<br>
  <br>
  <br>
  <br>
<br>
  <br>
  <br>
<br>
  <br>
  












 <div class="player">
 
    <!-- Define the section for displaying details -->
    <div class="details">
<div class="now-playing">PLAYING x OF y</div>
      <div class="track-art"></div>
      <div class="track-name">Track Name</div>
      <div class="track-artist">Track Artist</div>
    </div>
 <br>
 <br>  
    <!-- Define the section for displaying track buttons -->
    <div class="buttons">
    
      <div class="playpause-track" onclick="playpauseTrack()">
       <br>
 <img id= "med">
      </div>
     
    </div>

<br>
  
<br>

<!-- Define the section for displaying the seek slider-->
    <div class="slider_container">
      <div class="current-time"><strong>00:00</strong></div>
      <input type="range" min="1" max="100"
        value="0" class="seek_slider" >
      <div class="total-duration"><strong>00:00</strong></div>
    </div>
 
    <!-- Define the section for displaying the volume slider-->
    <div class="slider_container">
      <i class="fa fa-volume-down"></i>
      <input type="range" min="1" max="100"
        value="99" class="volume_slider" onchange="setVolume()">
      <i class="fa fa-volume-up"></i>











</div>
 <br>
<br>

   
<img id= "astro">
 </div>
<div id="clock-flash"></div>

<script>
function getClockEmoji(hour) {
  const h = hour % 12 === 0 ? 12 : hour % 12;
  const map = {
    1: "🕐", 2: "🕑", 3: "🕒", 4: "🕓", 5: "🕔", 6: "🕕",
    7: "🕖", 8: "🕗", 9: "🕘", 10: "🕙", 11: "🕚", 12: "🕛"
  };
  return map[h] || "🕰️";
}

function flashClock(hour) {
  const flashEl = document.getElementById("clock-flash");
  flashEl.textContent = getClockEmoji(hour);
  flashEl.classList.add("show");

  setTimeout(() => {
    flashEl.classList.remove("show");
  }, 3000); // visible for 3s
}


function scheduleHourlyFlash() {
  const now = new Date();
  const nextHour = new Date(now);
  nextHour.setHours(now.getHours() + 1, 0, 0, 0);
  const delay = nextHour - now;

  setTimeout(() => {
    triggerFlash();
    setInterval(triggerFlash, 3600000); // every hour
  }, delay);
}

function triggerFlash() {
  const hour = new Date().getHours();
  flashClock(hour);
  console.log(`${getClockEmoji(hour)} DJ Brain: It's ${hour}:00 sharp!`);
}

// Kick it off
document.addEventListener("DOMContentLoaded", scheduleHourlyFlash);
</script>







<br>
<br>

<br>
<br>


<br>
<br>

<h5 class="inch"><em> Todays Hotlist</em></h5><br>
<br>
<br>

<img id= "playlist">
<br>
<br>


<br>
<br>
<div><ul  id="track-list-container"></ul>
</div>
<div
</div>

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>



<div>



<IFRAME  SRC="https://rockgasts.netlify.app/gastt"  NORESIZE SCROLLING=NO HSPACE=0 VSPACE=0 FRAMEBORDER=0 MARGINHEIGHT=0 MARGINWIDTH=0  WIDTH=346 HEIGHT=390></IFRAME>


</div>






<br>
<br>

<br>
<br>


<br>
<br>

</div>

<br>
<br>



<br>
<br>
<br>
<br>


</div>
<div><h5 id="events">

<script>

  fetch('event.json')
  .then(response => response.json())
  .then(data => {
    const now = new Date();
    const todayName = now.toLocaleDateString('en-US', { weekday: 'long' });
    const events = data.schedule[todayName];

    if (events) {
      let eventsHTML = '<em><br><u>Upcoming Events</u></em><br><br>' + todayName + ':<br><br>';

      events.forEach(event => {
        const [start, end] = event.time.split(' - ');
        const startTime = new Date(now.toDateString() + ' ' + start);
        const endTime = new Date(now.toDateString() + ' ' + end);

        const isCurrent = now >= startTime && now <= endTime;
        const glowClass = isCurrent ? 'glow' : '';

        eventsHTML += `<div class="${glowClass}">${event.time}: <br><em>${event.event}</em><br><br></div>`;
      });

      document.getElementById('events').innerHTML = eventsHTML;
    } else {
      document.getElementById('events').innerHTML = '<em>Weekend events only! Come back Saturday.</em>';
    }
  })
  .catch(error => console.error('Error loading events:', error));

</script>

</div>

<br>
<br>
<br>
<IFRAME  SRC="https://shiphornn.netlify.app/treasuree"  NORESIZE SCROLLING=NO HSPACE=0 VSPACE=0 FRAMEBORDER=0 MARGINHEIGHT=0 MARGINWIDTH=0  WIDTH=346 HEIGHT=390></IFRAME>

<br>
<br>
<br>
<br>


<h5 class="inch"><em>Request   <span id="dark">A Song!</em></span></h5>


<br>
<br>
<br>
<br>

<div>
<IFRAME class="weather" SRC="https://sunnyjazzradio.netlify.app/subm.html" NORESIZE SCROLLING=NO HSPACE=0 VSPACE=0 FRAMEBORDER=0 MARGINHEIGHT=0 MARGINWIDTH=0 WIDTH=300 HEIGHT=556></IFRAME>
</div>







<br>
<br>
<br>
<br>
</div>
<div>
<br><img id="sunnyr">
<h5 id="time">
  </h5>

<br>
<br>
<div>
<img id= "hero-image">
<IFRAME  SRC="https://rockgast.netlify.app/rockstarss"  NORESIZE SCROLLING=NO HSPACE=0 VSPACE=0 FRAMEBORDER=0 MARGINHEIGHT=0 MARGINWIDTH=0  WIDTH=346 HEIGHT=490></IFRAME>
</div>

<br>
<br>



<br>
<br>
<br>
<br>


</div>


<div>


<h5 class="inch"><em>Wikipedia</em></h5>
<br>


<iframe class= "frame" src="https://nl.wikipedia.org/wiki/Iggy_Pop"></iframe>
</div>

<br>
<br>
<br>
<br>





<br>
<br>
<br>
<br>

 <div>
<h5 class="inch"><em>Weather Forecast</em></h5>
<br>




<IFRAME class="weather" SRC="buien.html" NORESIZE SCROLLING=NO HSPACE=0 VSPACE=0 FRAMEBORDER=0 MARGINHEIGHT=0 MARGINWIDTH=0 WIDTH=256 HEIGHT=506></IFRAME>

</div>




<br> 


<div>
<h5 class="inch"><em><span id= "play">Play</span> Find The Treasure</em></h5>
<IFRAME id="cata" SRC="https://catac.netlify.app/catac" NORESIZE SCROLLING=NO HSPACE=0 VSPACE=0 FRAMEBORDER=0 MARGINHEIGHT=0 MARGINWIDTH=0 WIDTH=340 HEIGHT=706></IFRAME>
</div>

<br>


 <div>
<h5 class="inch"><em>Countdown Timer</em></h5>

</div>
<div>
<IFRAME class="weather" SRC="https://countdownseason.netlify.app/countdown" NORESIZE SCROLLING=NO HSPACE=0 VSPACE=0 FRAMEBORDER=0 MARGINHEIGHT=0 MARGINWIDTH=0 WIDTH=345 HEIGHT=506></IFRAME>
</div>
<br> <br>
<br>























<audio id="musicPlayer" autoplay loop>
  <source id="musicSource"  type="audio/mpeg">
</audio>

<script>
window.addEventListener('load', () => {
  const musicPlayer = document.getElementById("musicPlayer");

  // Start at normal volume
  musicPlayer.volume = 0.7;

  // After 4 seconds, fade down a bit
  setTimeout(() => {
    const fadeDownDuration = 2000; // 2s fade down
    const fadeUpDuration   = 2000; // 2s fade back up
    const interval = 50;

    const startVolume = musicPlayer.volume;
    const lowVolume   = 0.3; // softer under DJ
    const normalVolume = 0.7;

    // Fade down
    let step = 0;
    const steps = fadeDownDuration / interval;
    const fadeDown = setInterval(() => {
      step++;
      let progress = step / steps;
      musicPlayer.volume = startVolume + (lowVolume - startVolume) * progress;
      if (step >= steps) {
        clearInterval(fadeDown);
        musicPlayer.volume = lowVolume;

        // Hold low volume for 5 seconds (DJ speaking)
        setTimeout(() => {
          // Fade back up
          let upStep = 0;
          const upSteps = fadeUpDuration / interval;
          const fadeUp = setInterval(() => {
            upStep++;
            let upProgress = upStep / upSteps;
            musicPlayer.volume = lowVolume + (normalVolume - lowVolume) * upProgress;
            if (upStep >= upSteps) {
              clearInterval(fadeUp);
              musicPlayer.volume = normalVolume; // restore
            }
          }, interval);
        }, 5000); // <-- how long to stay ducked
      }
    }, interval);
  }, 4000); // trigger 4s after load/play
});
</script>





<script>
    // 🎶 Define the tracks for each day
    const tracks = {
       0: "https://www.sunnyrockradio.com/muziek/pirate%20background/Sunny%20weekend%20piratejinglepublic.mp3",
        1: "https://www.sunnyrockradio.com/muziek/pirate%20background/Sunny%20weekly%20rockpirate.mp3",
        2: "https://www.sunnyrockradio.com/muziek/pirate%20background/Sunny%20weekly%20rockpirate.mp3",
        3: "https://www.sunnyrockradio.com/muziek/pirate%20background/Sunny%20weekly%20rockpirate.mp3",
        4: "https://www.sunnyrockradio.com/muziek/pirate%20background/Sunny%20weekly%20rockpirate.mp3",
        5: { 
            early: "https://www.sunnyrockradio.com/muziek/pirate%20background/Sunny%20weekly%20rockpirate.mp3", 
            after17: "https://www.sunnyrockradio.com/muziek/pirate%20background/Sunny%20weekdays%20public.mp3" 
        },
        6: "https://www.sunnyrockradio.com/muziek/pirate%20background/Sunny%20weekend%20piratejinglepublic.mp3"
    };

    // 🕰 Get the current day and hour
    const today = new Date().getDay();
    const currentHour = new Date().getHours();

    let selectedTrack;

    // Special condition for Friday (5) to switch track after 17:00
    if (today === 5) {
        selectedTrack = currentHour >= 17 ? tracks[5].after17 : tracks[5].early;
    } else {
        selectedTrack = tracks[today];
    }

    // 🎧 Set the source and load the track
    document.getElementById("musicSource").setAttribute('src', selectedTrack);
    const player = document.getElementById("musicPlayer");
    player.load(); 

  

 // 🎚️ Volume Balancer Function
        function adjustVolumeDynamically(audioElement) {
            if (!audioElement) {
                console.error("Error: `audioElement` is undefined!");
                return;
            }

            let targetVolume = 0.8;  // Default volume level
            let maxThreshold = 1; // Prevent distortion

            console.log(`🎛 Volume adjustment enabled for: ${audioElement.id}`);

            audioElement.addEventListener("timeupdate", () => {
                let currentVolume = audioElement.volume;

                if (currentVolume < targetVolume) {
                    audioElement.volume = Math.min(maxThreshold, currentVolume + 0.01);  // Smooth increase
                } else if (currentVolume > targetVolume) {
                    audioElement.volume = Math.max(0, currentVolume - 0.01);  // Smooth decrease
                }
            });
        }





        // 🌟 Ensure DOM is ready before executing script
        document.addEventListener("DOMContentLoaded", () => {
            console.log("DOM loaded—setting up audio sources.");

            // 🎵 Assign sources to scheduled sounds
            const audioFiles = {
                hourlySound: "muziek/effects/hour soundfinale.mp3",
                quarterHourSound: "muziek/effects/blast.mp3",
                
            };

            Object.entries(audioFiles).forEach(([id, src]) => {
                const audioElement = document.getElementById(id);
                if (audioElement) {
                    audioElement.setAttribute("src", src);
                    console.log(`✅ Source set for ${id}: ${src}`);
                } else {
                    console.error(`❌ Error: Element '${id}' not found!`);
                }
            });

            // 🎛 Apply volume normalization when a track is ready to play
            document.querySelectorAll("audio").forEach(audio => {
                audio.addEventListener("canplay", () => adjustVolumeDynamically(audio));
            });
        });

  
    

 // 🎛 Volume Balancer Function
    function adjustVolumeDynamically(audioElement) {
        let targetVolume = 0.8;  // Default volume level
        let maxThreshold = 1; // Prevent distortion

        audioElement.addEventListener("timeupdate", () => {
            if (audioElement.volume < targetVolume) {
                audioElement.volume = Math.min(maxThreshold, audioElement.volume + 0.01);  // Smooth increase
            } else if (audioElement.volume > targetVolume) {
                audioElement.volume = Math.max(0, audioElement.volume - 0.01);  // Smooth decrease
            }
        });
    }





window.addEventListener("load", () => {
  loadTrack(0);        // Load your first track
  playTrack();         // Start playing it
  if (curr_track) {
  curr_track.muted = false;
}

});



</script>











    <audio id="hourlySound" src=""></audio>
    <audio id="quarterHourSound" src=""></audio>
    <audio id="fortyFiveMinuteSound" src=""></audio>


























<script>
//Get our img element by using document.getElementById
var img = document.getElementById("logo");

//Set the src property of our element to the new image URL
img.src = 'images/Rock11.png';
</script>








<script>
//Get our img element by using document.getElementById
var img = document.getElementById("playlist");

//Set the src property of our element to the new image URL
img.src = 'images/Sunny playlist.png';
</script>








<script>



//Get our img element by using document.getElementById
var img = document.getElementById("dwarf");

//Set the src property of our element to the new image URL
img.src = 'images/red star2.png';
</script>










<script>
window.onscroll = function() {myFunction()};

var header = document.getElementById("myHeader");
var sticky = header.offsetTop;

function myFunction() {
  if (window.pageYOffset > sticky) {
    header.classList.add("sticky");
  } else {
    header.classList.remove("sticky");
  }
}
</script>








<script>
function startTime() {
    const today = new Date();
    let h = today.getHours();
    let m = today.getMinutes();
    let s = today.getSeconds();
    
    m = checkTime(m);
    s = checkTime(s);
    
    document.getElementById('time').innerHTML = "Sunny Time: " + h + ":" + m + ":" + s;
    
    setTimeout(startTime, 1000);
}

function checkTime(i) {
    return i < 10 ? "0" + i : i; // Add zero in front of numbers < 10
}

// Call the function to start the clock
startTime();

</script>



  











































































<script>
//Get our img element by using document.getElementById
var img = document.getElementById("med");

//Set the src property of our element to the new image URL
img.src = 'images/pause66.gif';
</script>






<script>
//Get our img element by using document.getElementById
var img = document.getElementById("licht");

//Set the src property of our element to the new image URL
img.src = 'images/red star3.png';
</script>

<script>
//Get our img element by using document.getElementById
var img = document.getElementById("sunnyr");

//Set the src property of our element to the new image URL
img.src = 'images/Sunny4.png';
</script>



<script>
//Get our img element by using document.getElementById
var img = document.getElementById("astro");

//Set the src property of our element to the new image URL
img.src = 'images/red star2.png';
</script>
  
<script>
//Get our img element by using document.getElementById
var img = document.getElementById("lin");

//Set the src property of our element to the new image URL
img.src = 'images/Sunny6.png';
</script>

<script>
//Get our img element by using document.getElementById
var img = document.getElementById("linger");

//Set the src property of our element to the new image URL
img.src = 'images/Sunny7.png';
</script>














<script> 
document.getElementById("events").innerHTML="<em><br><u></em></u><br><br>  <br><br><br><em></em> <br> <br> <br><em></em><br><br>"; 
</script>


<script>
function generateSchedule() {
    const today = new Date();
    const schedule = {};
    const weekendDays = [5, 6, 0]; // Friday (5), Saturday (6), Sunday (0)
    
    const events = {
        5: [ // Friday
            { time: "03:00 - 12:00", event: "Morning Rock" },
            { time: "12:00 - 17:00", event: "Hillbillies Event" },
            { time: "17:00 - 23:00", event: "Hillbillies Party" },
            { time: "23:00 - 03:00", event: "Evening Rock" }
        ],
        6: [ // Saturday
             { time: "03:00 - 12:00", event: "Morning Rock" },
            { time: "12:00 - 17:00", event: "Hillbillies Event" },
            { time: "17:00 - 23:00", event: "Hillbillies Party" },
            { time: "23:00 - 03:00", event: "Evening Rock" }

        ],
        0: [ // Sunday
             { time: "03:00 - 12:00", event: "Morning Rock" },
            { time: "12:00 - 17:00", event: "Hillbillies Event" },
            { time: "17:00 - 23:00", event: "Hillbillies Party" },
            { time: "23:00 - 03:00", event: "Evening Rock" }

        ]
    };

    for (let i = 1; i <= 7; i++) {
        let date = new Date();
        date.setDate(today.getDate() + i);
        let dayOfWeek = date.getDay();

        if (weekendDays.includes(dayOfWeek)) {
            schedule[date.toISOString().split("T")[0]] = events[dayOfWeek];
        }
    }

    return schedule;
}

// console.log("Generated Schedule:", JSON.stringify(generateSchedule(), null, 2));
// console.log("Loading track:", scheduledMp3Files[track_index].name, "-", scheduledMp3Files[track_index].artist);


</script>










    

<script>
document.getElementById("hourlySound").setAttribute('src', 'audio/its%20now.mp3');
document.getElementById("quarterHourSound").setAttribute('src', 'muziek/effects/rotating sound.mp3');
document.getElementById("fortyFiveMinuteSound").setAttribute('src', 'muziek/effects/rotating sound.mp3');
</script>






<script>
        function playSound(audioIds) {
            audioIds.forEach(function(id) {
                var audio = document.getElementById(id);
                if (audio) {
                    audio.play().then(() => {
                        console.log(`Playing ${id}`);
                    }).catch(error => {
                        console.error(`Error playing ${id}:`, error);
                    });
                } else {
                    console.error(`Audio element with ID ${id} not found.`);
                }
            });
        }
    </script>

    <script>
        function scheduleSounds() {
            console.log("Scheduling sounds...");
            var now = new Date();
            
            // Calculate delay for hourly sound
            var hourlyDelay = (60 - now.getMinutes()) * 60 * 1000 - now.getSeconds() * 1000;
            setTimeout(function() {
                playSound(["hourlySound"]);
                setInterval(function() {
                    playSound(["hourlySound"]);
                }, 3600000); // Every hour (3600000 milliseconds)
            }, hourlyDelay);

            // Calculate delay for quarter-hour sound
            var quarterHourDelay = (15 - (now.getMinutes() % 15)) * 60 * 1000 - now.getSeconds() * 1000;
            setTimeout(function() {
                playSound(["quarterHourSound"]);
                setInterval(function() {
                    playSound(["quarterHourSound"]);
                }, 900000); // Every 15 minutes (900000 milliseconds)
            }, quarterHourDelay);

            // Calculate delay for forty-five-minute sound
            var fortyFiveMinuteDelay = (45 - (now.getMinutes() % 45)) * 60 * 1000 - now.getSeconds() * 1000;
            setTimeout(function() {
                playSound(["fortyFiveMinuteSound"]);
                setInterval(function() {
                    playSound(["fortyFiveMinuteSound"]);
                }, 2700000); // Every 45 minutes (2700000 milliseconds)
            }, fortyFiveMinuteDelay);
        }

        window.onload = scheduleSounds;
    </script>


<audio id="hourlyAnnounce"></audio>

<script>
// List of hourly audio files, 0–23
const sources = [
  "audio/0.mp3","audio/1.mp3","audio/2.mp3","audio/3.mp3","audio/4.mp3","audio/5.mp3",
  "audio/6.mp3","audio/7.mp3","audio/8.mp3","audio/9.mp3","audio/10.mp3","audio/11.mp3",
  "audio/12.mp3","audio/13.mp3","audio/14.mp3","audio/15.mp3","audio/16.mp3","audio/17.mp3",
  "audio/18.mp3","audio/19.mp3","audio/20.mp3","audio/21.mp3","audio/22.mp3","audio/23.mp3"
];

let hourlyTimer; // keep reference so we don’t double‑schedule

// Helper: get the current hour in Amsterdam time
function getAmsterdamHour() {
  return parseInt(new Date().toLocaleString("en-GB", {
    timeZone: "Europe/Amsterdam",
    hour: "numeric",
    hour12: false
  }), 10);
}

// Play the correct hourly file
function playHourly(audioElement) {
  const hour = getAmsterdamHour();
  audioElement.src = sources[hour];
  audioElement.load();
  audioElement.play().catch(err => {
    console.error("Playback failed:", err);
  });
}

// Schedule the hourly announcement
function scheduleHourlyAnnounce() {
  const audioElement = document.getElementById('hourlyAnnounce');
  if (!audioElement) {
    console.error("Audio element not found!");
    return;
  }

  // Clear any existing timer to avoid duplicates
  if (hourlyTimer) {
    clearInterval(hourlyTimer);
    hourlyTimer = null;
  }

  const now = new Date();
  // Compute next top of the hour in Amsterdam time
  const amsNow = new Date(now.toLocaleString("en-US", { timeZone: "Europe/Amsterdam" }));
  const nextHour = new Date(amsNow);
  nextHour.setHours(amsNow.getHours() + 1, 0, 0, 0);
  const delay = nextHour - amsNow;

  // Wait until the top of the next hour
  setTimeout(() => {
    playHourly(audioElement);

    // Then repeat every hour
    hourlyTimer = setInterval(() => {
      playHourly(audioElement);
    }, 3600000);
  }, delay);
}

// Kick it off after first user gesture
document.addEventListener("click", function init() {
  scheduleHourlyAnnounce();
  document.removeEventListener("click", init);
});
</script>

<script>
function getCurrentCategory() {
  const nowHour = new Date().getHours(); // LOCAL hour
  return timeRanges.find(r =>
    (r.start <= r.end && nowHour >= r.start && nowHour < r.end) ||
    (r.start > r.end && (nowHour >= r.start || nowHour < r.end))
  )?.key || "unknown";
}
</script>



<audio id="djIntro"></audio>
<audio id="musicplayer" preload="auto" loop></audio>

<script>
window.addEventListener('load', () => {
  const djIntro = document.getElementById('djIntro');
  const musicplayer = document.getElementById('musicplayer');

  if (!djIntro || !musicplayer) {
    console.error("Missing audio elements.");
    return;
  }

  // --- Define schedules ---
  const weekdaySlots = [
    { start: 0,  end: 12, file: "muziek/jockeys/starten met Sunny.mp3" },
    { start: 12, end: 18, file: "muziek/jockeys/Rock Music Seventies.mp3" },
    { start: 18, end: 24, file: "muziek/voiceover/From The Heart Of Amsterdam2.mp3" }
  ];

  const weekendSlots = [
    { start: 0,  end: 14, file: "muziek/jockeys/40 in jingle.mp3" },
    { start: 14, end: 20, file: "muziek/voiceover/From The Heart Of Amsterdam2.mp3" },
    { start: 20, end: 24, file: "muziek/jockeys/Rock Music Seventies.mp3" }
  ];

  // --- Helpers ---
  function getCurrentSlot() {
    const now = new Date();
    const hour = now.getHours();
    const day = now.getDay(); // 0 = Sunday, 6 = Saturday
    const isWeekend = (day === 0 || day === 6);
    const schedule = isWeekend ? weekendSlots : weekdaySlots;
    return schedule.find(slot => hour >= slot.start && hour < slot.end);
  }

  function fadeVolume(audioEl, from, to, duration) {
    const steps = 20;
    const stepTime = duration / steps;
    let currentStep = 0;
    audioEl.volume = from;

    const interval = setInterval(() => {
      currentStep++;
      audioEl.volume = from + (to - from) * (currentStep / steps);
      if (currentStep >= steps) clearInterval(interval);
    }, stepTime);
  }

  function playIntro(slot) {
    if (!slot) return;

    // Fade down the music
    fadeVolume(musicplayer, musicplayer.volume || 1.0, 0.2, 1000);

    djIntro.src = slot.file;
    djIntro.volume = 1.0;

    djIntro.play().catch(err => console.log("Intro can't autoplay:", err));

    // When intro ends, fade music back up
    djIntro.onended = () => {
      fadeVolume(musicplayer, 0.2, 1.0, 1000);
    };
  }

  // --- Initial setup ---
  let currentSlot = getCurrentSlot();
  playIntro(currentSlot);

  // --- Re-check every 15 minutes ---
  setInterval(() => {
    const newSlot = getCurrentSlot();
    if (newSlot && newSlot.file !== currentSlot?.file) {
      console.log(`⏰ Transition: ${currentSlot?.file} → ${newSlot.file}`);
      playIntro(newSlot);
      currentSlot = newSlot;
    }
  }, 15 * 60 * 1000);
});
</script>
<script>
// --- Shuffle Modes ---
const ShuffleModes = {
  balancedBias: track => 1 / (1 + track.playcount),
  deepCrateDig: track => 1 / Math.pow(1 + track.playcount, 2),
  crowdPleaser: track => 1 / (1 + Math.abs(track.playcount - medianPlaycount()))
};

function medianPlaycount() {
  const counts = scheduledMp3Files.map(t => t.playcount).sort((a,b) => a-b);
  const mid = Math.floor(counts.length / 2);
  return counts.length % 2 ? counts[mid] : (counts[mid-1] + counts[mid]) / 2;
}

function weightedPick(tracks, mode = 'balancedBias') {
  const weightFn = ShuffleModes[mode];
  const weights = tracks.map(t => weightFn(t));
  const total = weights.reduce((a, b) => a + b, 0);

  let r = Math.random() * total;
  for (let i = 0; i < tracks.length; i++) {
    r -= weights[i];
    if (r <= 0) return tracks[i];
  }
  return tracks[tracks.length - 1];
}

// --- Mood logic ---
function getShuffleMode() {
  const hour = new Date().getHours();

  if (hour >= 6 && hour < 12) {
    return "balancedBias";   // morning: smooth and fair
  } else if (hour >= 12 && hour < 18) {
    return "crowdPleaser";   // afternoon: familiar energy
  } else if (hour >= 18 && hour < 22) {
    return "deepCrateDig";   // evening: dig into rarities
  } else {
    return "balancedBias";   // late night: calm balance
  }
}

// --- Fade helper ---
function fadeIn(audio, targetVolume, step, interval) {
  let vol = audio.volume;
  const fade = setInterval(() => {
    vol = Math.min(vol + step, targetVolume);
    audio.volume = vol;
    if (vol >= targetVolume) clearInterval(fade);
  }, interval);
}

// --- Main intro + overlap logic ---
function playIntroWithOverlap(file) {
  const djIntro = document.getElementById('djIntro');
  const djPlayer = document.getElementById('djPlayer');

  djIntro.src = file;
  djIntro.currentTime = 0;
  djIntro.volume = 1.0;
  djPlayer.volume = 0;

  // Delay intro playback by 4 seconds
  setTimeout(() => {
    djIntro.play().then(() => {
      djIntro.addEventListener('timeupdate', function overlapHandler() {
        if (djIntro.duration && djIntro.currentTime >= djIntro.duration - 3) {
          djIntro.removeEventListener('timeupdate', overlapHandler);

          // Pick shuffle mode automatically
          const mode = getShuffleMode();
          const nextTrack = weightedPick(scheduledMp3Files, mode);
          console.log("🎶 Mode:", mode, "→", nextTrack.name, "playcount:", nextTrack.playcount);

          nextTrack.playcount++;

          djPlayer.src = nextTrack.url;
          djPlayer.play()
            .then(() => fadeIn(djPlayer, 0.7, 0.05, 200))
            .catch(err => console.warn("Music failed:", err));
        }
      });
    }).catch(err => console.warn("Intro failed:", err));
  }, 4000);
}
</script>

<style>
  .badge {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.3rem;
    padding: 0.6rem 0.8rem;
    border-radius: 12px;
    color: #333333;
    background-color: transparent;
    box-shadow: 0 6px 16px rgba(0,0,0,0.35);
    font: 600 14px/1.2 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;
    width: 200px;
    z-index: 9999;
  }
  .badge-icon { margin-right: 0.4rem; }
  .badge-label { white-space: nowrap; }
  .progress {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,0.15);
    border-radius: 4px;
    overflow: hidden;
  }
  .progress-bar {
    height: 100%;
    width: 0%;
    background: #6ea8ff;
    transition: width 1s linear;
  }
</style>

<!-- Time-block badge with progress bar -->
<div id="timeBadge" class="badge" aria-live="polite" aria-atomic="true">
  <span class="badge-icon">🕒</span>
  <span class="badge-label">Loading…</span>
  <div class="progress">
    <div class="progress-bar"></div>
  </div>
</div>

<script>
function getTimeBounds(range) {
  const now = new Date();
  let start = new Date(now);
  let end = new Date(now);
  start.setHours(range.start, 0, 0, 0);
  end.setHours(range.end, 0, 0, 0);
  if (range.start > range.end) {
    if (now.getHours() >= range.start) end.setDate(end.getDate() + 1);
    else start.setDate(start.getDate() - 1);
  }
  return { start, end };
}

const badgeMeta = {
  morning: { icon: "🌅", label: "Morning" },
  afternoon: { icon: "☀️", label: "Afternoon" },
  evening: { icon: "🌇", label: "Evening" },
  "evening-late": { icon: "🌃", label: "Evening Late" },
  night: { icon: "🌙", label: "Night" },
  late: { icon: "🦉", label: "Late" },
  "special-show": { icon: "🎛️", label: "Special Show" },
  "jingle-time": { icon: "🔔", label: "Jingle Time" },
  unknown: { icon: "🕒", label: "On Air" }
};

const aliases = {
  morning: ["Morning Rise", "Sunrise Grooves", "Early Light"],
  afternoon: ["Afternoon Flow", "Daylight Beats", "Sunny Sessions"],
  evening: ["Evening Groove", "Evening Flow", "Evening Pulse"],
  "evening-late": ["Late Evening Lights", "Twilight Grooves", "Sundown Sessions"],
  night: ["Night Drift", "Moonlight Mix", "Starlight Sessions"],
  late: ["Owl Hours", "Midnight Frequencies", "After Hours"],
  "special-show": ["Special Mix", "Spotlight Session", "Feature Hour"],
  "jingle-time": ["Jingle Time", "Station ID", "Bumper Beats"]
};

let cachedAlias = null;

function getAlias(category) {
  if (cachedAlias && cachedAlias.category === category) {
    return cachedAlias.label;
  }
  if (aliases[category]) {
    const list = aliases[category];
    const label = list[Math.floor(Math.random() * list.length)];
    cachedAlias = { category, label };
    return label;
  }
  return badgeMeta[category]?.label || category;
}

// Example ranges (adjust to your station’s schedule)
const timeRanges = [
  { key: "morning", start: 6, end: 12 },
  { key: "afternoon", start: 12, end: 17 },
  { key: "evening", start: 17, end: 21 },
  { key: "evening-late", start: 21, end: 23 },
  { key: "night", start: 23, end: 2 },
  { key: "late", start: 2, end: 6 }
];

function updateTimeBadge(categoryKey) {
  const badge = document.getElementById("timeBadge");
  if (!badge) return;
  const meta = badgeMeta[categoryKey] || badgeMeta.unknown;
  const range = timeRanges.find(r => r.key === categoryKey) || timeRanges.find(r => r.key === "night");
  const { start, end } = getTimeBounds(range);

  const now = new Date();
  const total = end - start;
  const elapsed = now - start;
  const remaining = end - now;

  const hours = Math.floor(remaining / 3600000);
  const mins = Math.floor((remaining % 3600000) / 60000);

  badge.querySelector(".badge-icon").textContent = meta.icon;
  const label = getAlias(categoryKey);
  badge.querySelector(".badge-label").textContent =
    `${label} · ${hours > 0 ? hours + "h " : ""}${mins}m left`;

  const percent = Math.max(0, Math.min(100, (elapsed / total) * 100));
  badge.querySelector(".progress-bar").style.width = percent + "%";
}



function startBadgeLoop() {
  function tick() {
    const cat = getCurrentCategory();
    updateTimeBadge(cat);
  }
  tick();
  setInterval(tick, 60000);
}

document.addEventListener("DOMContentLoaded", startBadgeLoop);
</script>










<script src="main3.js"></script>




</body>
</html>
